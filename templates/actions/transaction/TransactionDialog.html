{** @var cashTransactionDto $transaction **}
{** @var cashAccountDto[] $accounts **}
{** @var cashCategoryDto[] $categories **}
{** @var cashCategoryDto[] $categoriesIncome **}
{** @var cashTransactionPageFilterDto $filter **}
{** @var string $categoryType **}
<section>
    <div class="dialog-content">
        <div data-cash-wrapper="transaction-add-dialog">
            <input type="hidden" name="transaction[id]" value="{$transaction->id|default:0}"/>
            <input type="hidden" name="transaction[category_type]" value="{$categoryType}"/>

            <h1>
                {if $transaction->id}
                    [`Edit transaction`]
                {else}
                {if $categoryType == 'income'}
                    [`New income`]
                {elseif $categoryType == 'expense'}
                    [`New expense`]
                {else}
                    [`New transfer`]
                {/if}
                {/if}
            </h1>
            <div class="fields form">
                <div class="field-group">
                    <div class="field">
                        <div class="name nowrap">
                            [`Amount`]
                        </div>
                        <div class="value">
                            {if $categoryType == 'expense'}<strong>&minus;</strong>{/if}
                            <input type="text"
                                   class="large bold numerical"
                                   name="transaction[amount]"
                                   placeholder="0"
                                   style="width: 130px !important; min-width: 0;"
                                   {if $transaction->amount|abs}value="{$transaction->amount|abs}"{/if} />
                            <strong data-cash-transaction-account-currency>
                                {if $filter->type === cashTransactionPageFilterDto::FILTER_ACCOUNT && $filter->id}
                                {$accounts[$transaction->account->id]->currency->getSign()|escape}
                                {/if}
                            </strong>
                        </div>
                    </div>
                    <div class="field">
                        <div class="name nowrap">
                            [`Account`]
                        </div>
                        <div class="value no-shift">
                            <select name="transaction[account_id]">
                                {foreach $accounts as $account}
                                    <option value="{$account->id}"
                                            {if $account->id == $transaction->account->id}selected{/if}
                                            data-cash-account-currency-sign="{$account->currency->getSign()|escape}">
                                        {$account->currency->getCode()|escape} - {$account->name|escape} ({$account->currency->getSign()|escape})
                                    </option>
                                {/foreach}
                            </select>
                        </div>
                    </div>
                    <div class="field">
                        <div class="name nowrap">
                            [`Category`]
                        </div>
                        <div class="value no-shift">
                            <i class="icon16 color" data-cash-transaction-category style="background: none;"></i>
                            <select name="transaction[category_id]">
                                <option value="0" data-cash-category-color="{cashColorStorage::DEFAULT_NO_CATEGORY_GRAPH_COLOR}">[`No category`]</option>
                                {foreach $categories as $category}
                                    <option value="{$category->id}"
                                            {if $category->id == $transaction->category->id}selected{/if}
                                            data-cash-category-color="{$category->color}">
                                        {$category->name|escape}
                                    </option>
                                {/foreach}
                            </select>
                        </div>
                    </div>
                    <div class="field">
                        <div class="name nowrap">
                            [`Description`]
                        </div>
                        <div class="value no-shift">
                            <textarea name="transaction[description]"
                                      cols="30"
                                      rows="10"
                                      placeholder="[`Optional`]"
                            >{$transaction->description|escape}</textarea>
                        </div>
                    </div>
                    <div class="field">
                        <div class="name nowrap">
                            [`Date`]
                        </div>
                        <div class="value">
                            <input type="text"
                                   name="transaction[date]"
                                   value="{$transaction->date}"/>
                            <i class="icon16 calendar"></i>
                            <span class="hint">[`Any date in the past or in the future`]</span>
                        </div>
                    </div>

                    {if 1 || NEW_TRANSACTION}
                        <div class="field">
                            <div class="name nowrap">
                                [`Repeat`]
                            </div>
                            <div class="value no-shift">
                                <select>
                                    <option>[`None`]</option>
                                    <option>[`Every day`]</option>
                                    <option>[`Every week`]</option>
                                    <option>[`Every month`]</option>
                                    <option>[`Every year`]</option>
                                    <option>[`Custom...`]</option>
                                </select>
                                <!--

                                    /// if 'Custom...' is selected ///

                                [`Every`]
                                <input type="text" class="numerical short" value="1">
                                <select>
                                    <option>[`day`]</option>
                                    <option>[`week`]</option>
                                    <option>[`month`]</option>
                                    <option>[`year`]</option>
                                </select>

                                -->
                            </div>
                        </div>
                        <div class="field" style="opacity: 0.54321 {* /// if 'Repeat' != 'None' /// *}">
                            <div class="name nowrap">
                                [`End repeat`]
                            </div>
                            <div class="value no-shift">
                                <select>
                                    <option>[`Never`]</option>
                                    <option>[`After`]</option>
                                    <option>[`On date`]</option>
                                </select>
                                <!-- /// if 'After' is selected /// <input type="text" class="numerical short" value="12"> [`occurencies`] -->
                                <!-- /// if 'On date' is selected /// <input type="text" > <i class="icon16 calendar"></i> -->
                            </div>
                        </div>

                    {else if 1 || THIS_IS_A_REPEATING_TRANSACTION_AND_THERE_ARE_AT_LEAST_ONE_OCCURENCE_IN_THE_FUTURE}

                        {* editing existing transaction *}
                        <div class="field">
                            <div class="value no-shift">
                                <label>
                                    <input type="checkbox" />
                                    [`Apply this change to all future repeating transations`]
                                    {if 1 || END_REPEAT != NEVER}
                                        (5)
                                    {/if}
                                </label>
                                <span class="hint"></span>
                            </div>
                        </div>

                        <!-- /// same 'Repeat' & 'End repeat' fields once again (just as for the new transaction) /// -->

                        <div class="field">
                            <div class="name nowrap">
                                [`Repeat`]
                            </div>
                            <div class="value no-shift">
                                <select>
                                    <option>[`None`]</option>
                                    <option>[`Every day`]</option>
                                    <option>[`Every week`]</option>
                                    <option>[`Every month`]</option>
                                    <option>[`Every year`]</option>
                                    <option>[`Custom...`]</option>
                                </select>
                                <!--

                                    /// if 'Custom...' is selected ///

                                [`Every`]
                                <input type="text" class="numerical short" value="1">
                                <select>
                                    <option>[`day`]</option>
                                    <option>[`week`]</option>
                                    <option>[`month`]</option>
                                    <option>[`year`]</option>
                                </select>

                                -->
                            </div>
                        </div>
                        <div class="field" style="opacity: 0.54321 {* /// if 'Repeat' != 'None' /// *}">
                            <div class="name nowrap">
                                [`End repeat`]
                            </div>
                            <div class="value no-shift">
                                <select>
                                    <option>[`Never`]</option>
                                    <option>[`After`]</option>
                                    <option>[`On date`]</option>
                                </select>
                                <!-- /// if 'After' is selected /// <input type="text" class="numerical short" value="12"> [`occurencies`] -->
                                <!-- /// if 'On date' is selected /// <input type="text" > <i class="icon16 calendar"></i> -->
                            </div>
                        </div>

                    {/if}
                    {if $categoryType == cashCategory::TYPE_TRANSFER}
                    <div class="field">
                        <div class="name nowrap">
                            [`Transaction account to transfer`]
                        </div>
                        <div class="value">
                            <select name="transfer[account_id]">
                                {foreach $accounts as $account}
                                    <option value="{$account->id}">
                                        {$account->name|escape} ({$account->currency->getSign()|escape})
                                    </option>
                                {/foreach}
                            </select>
                        </div>
                    </div>
                    {/if}

                    {if $categoryType == cashCategory::TYPE_TRANSFER}
                        <div class="field">
                            <div class="name nowrap">
                                [`Transaction category to transfer`]
                            </div>
                            <div class="value">
                                <select name="transfer[category_id]">
                                    <option value="0">[`No category`]</option>
                                    {foreach $categoriesIncome as $category}
                                        <option value="{$category->id}" {if $category->id == $transaction->category->id}selected{/if}>
                                            {$category->name|escape}
                                        </option>
                                    {/foreach}
                                </select>
                            </div>
                        </div>
                    {/if}
                </div>

                <!-- plugin hook: 'backend_transaction_dialog' -->
                {* @event backend_transaction_dialog.%plugin_id% *}
                {if !empty($backend_transaction_dialog)}{foreach $backend_transaction_dialog as $_}{ifset($_)}{/foreach}{/if}

            </div>
        </div>
    </div>

    <div class="dialog-buttons">
        {if $transaction->id}
            <div class="block half-padded float-right">
                <ul class="menu-h">
                    <li>
                        <a href="#" data-cash-action="delete-transaction" data-cash-transaction-id="{$transaction->id}"><i class="icon16 delete"></i> [`Delete transaction`]</a>
                    </li>
                </ul>
            </div>
        {/if}
        <input type="submit" value="[`Save`]" class="button green"/> [`or`] <a class="cancel" href="#">[`cancel`]</a>
        <div class="errormsg" style="display: none"></div>
    </div>
</section>
