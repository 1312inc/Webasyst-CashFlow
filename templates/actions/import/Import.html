{** @var $importMenu cashImportMenuItemInterface[] **}

<div id="cash-import-page" class="article">
    <div class="article-body">

        <h1>[`Import`]</h1>

        <div class="custom-my-16">
            <ul class="tabs bordered-bottom">

                {foreach $importsMenu as $importsMenus}
                    {foreach $importsMenus as $importMenu}
                        <li class="{if $importMenu->getIdentifier() === $current_menu}selected{/if}">
                            <a href="{$wa_app_url}{if $importMenu->getUrl()}{$importMenu->getUrl()}{else}import/new/{$importMenu->getIdentifier()}{/if}/">{$importMenu->getAnchor()}</a>
                        </li>
                    {/foreach}
                {/foreach}

            </ul>
        </div>

    {if count($imports)}
        <div>
            <p class="small">[`Review and manage previous import results:`]</p>
            <ul class="chips rounded small">
                {** @var cashImportDto $import **}
                {foreach $imports as $import}
                    <li>
                        <a href="{$wa_app_url}import/{$import->id}?importinfo={base64_encode($import->filename|escape|cat:' / '|cat:$import->create_datetime)}">
                            {*
                                <img class="userpic" src="{$import->contact->getPhoto(20)}" />
                            *}
                            <i class="fas fa-file-excel" style="color: #499b5e;"></i>
                            <strong>{sprintf('%d transactions', $import->success)}</strong>
                            {$import->create_datetime|wa_datetime:humandatetime}

                            <span class="hint">
                            {$import->filename|escape|truncate:24}
                        </span>
                        </a>
                    </li>
                {/foreach}
                <li class="transparent small">
                    <a href="#" class="count" data-cash-action="imports-delete">
                        <i class="fas fa-times-circle"></i>
                        [`Dismiss import history`]
                    </a>
                </li>
            </ul>
        </div>
        <hr>
    {/if}

        <section id="c-import">
            {$import_html}
        </section>

    </div>
</div>

<script>
    'use strict';
    (function () {
        var $w = $('#cash-import-page');

        $w.on('click.cash', '[data-cash-action="imports-delete"]', function (e) {
            e.preventDefault();

            if (!confirm($_('Clear import history (donâ€™t worry, imported transactions will not be affected)?'))) {
                return;
            }

            $.post(
                '?module=import&action=deleteAll',
                function (r) {
                    if (r.status === 'ok') {
                        window.location.reload();
                    } else {
                        self.log(r.errors.join("\n"));
                        alert(r.errors.join("\n"));
                    }
                },
                'json'
            );
        });
    }())
</script>
