{** $currentPeriod cashReportDdsPeriod **}
{** $reportPeriods cashReportDdsPeriod[] **}
{** $ddsTypes cashReportDdsTypeDto[] **}
{** $type cashReportDdsTypeDto **}
{** $grouping cashReportDdsPeriodGroupingDto[] **}
{** $data cashReportDdsStatDto[] **}

<div class="content left200px">

    <div class="block">

        <h1>[`Cash flow report`]</h1>

        <ul class="menu-h dropdown">
            <li>
                <a href="javascript:void(0);" class="inline-link"><b><i><strong>{$currentPeriod->getName()}</strong></i></b> <i class="icon10 darr"></i></a>
                <ul class="menu-v" style="min-width: 100px;">
                    {foreach $reportPeriods as $reportPeriod}
                    <li {if $currentPeriod->isEqual($reportPeriod)}class="selected"{/if}>
                        <a href="#/report/dds/{$type->id}/{$reportPeriod->getValue()}"
                           data-cash-period-value="{$reportPeriod->getValue()}"
                           data-cash-period-start="{$reportPeriod->getStartDate()}"
                           data-cash-period-end="{$reportPeriod->getEndDate()}"
                        >
                            {$reportPeriod->getName()|escape}
                        </a>
                    </li>
                    {/foreach}
                </ul>
            </li>
            {foreach $ddsTypes as $ddsType}
            <li {if $type->id == $ddsType->id}class="selected"{/if}>
                <a href="#/report/dds/{$ddsType->id}/{$currentPeriod->getValue()}">
                    {$ddsType->name|escape}
                </a>
            </li>
            {/foreach}
        </ul>

        <input type="hidden" value="{$type->id}" name="dds[type]"/>

        <br>

        <table class="zebra">
            <thead>
            <tr>
                <th></th>
                {foreach $grouping as $group}
                    <th class="align-right">{$group->name|escape}</th>
                {/foreach}
                <th class="align-right bold">[`Total`]</th>
                {if $type->hasChart}
                    <th class="c-report-pie-header"></th>
                {/if}
            </tr>
            </thead>

            <tbody>
            {foreach $data as $datum}
            <tr>
                <td class="nowrap">
                    {if $datum->entity->isHeader()}<b>{/if}
                    {$datum->entity->getIcon()}{$datum->entity->getName()|escape|truncate:32}
                    {if $datum->entity->isHeader()}</b>{/if}
                </td>
                {if !empty($datum->valuesPerPeriods)}
                    {$_total = 0}
                    {foreach $datum->valuesPerPeriods as $values}
                        <td>
                            {foreach $values as $value}
                                <div class="nowrap align-right">
                                    {if $value.per_month<0}&minus;{/if} {round(abs($value.per_month),2)|wa_format_number:false}
                                    {$datum->currencies[$value.currency]->getSign()}
                                    {$_total = $_total + $value.per_month}
                                </div>
                            {/foreach}
                        </td>
                    {/foreach}
                    <td class="nowrap align-right bold">
                        {if $_total<0}&minus;{/if} {round(abs($_total),2)|wa_format_number:false}
                        {$datum->currencies[$value.currency]->getSign()}
                    </td>
                {else}
                    <td colspan="{count($grouping) + 1}" class="align-center gray">â€”</td>
                {/if}
                {if $datum->entity->isHeader() && $type->hasChart}
                <td rowspan="{if $datum->entity->isExpense()}{$type->expenseEntities}{/if}{if $datum->entity->isIncome()}{$type->incomeEntities}{/if}" class="c-report-pie-column">
                    {foreach $datum->currencies as $currency}
                    <h5>{if $datum->entity->isExpense()}[`Expenses`]{/if}{if $datum->entity->isIncome()}[`Income`]{/if} {$currency->getCode()}</h5>
                    <div class="c-chart-pie"
                         id="cash-chart-{if $datum->entity->isExpense()}{cashReportDds::ALL_EXPENSE_KEY}{/if}{if $datum->entity->isIncome()}{cashReportDds::ALL_INCOME_KEY}{/if}-{$currency->getCode()}"
                    ></div>
                    {/foreach}
                </td>
                {/if}
            </tr>
            {/foreach}
            </tbody>
        </table>

    </div>

<script>
    "use strict";
    (function ($){
        var chartData = {$chartData},
            charts = [];

        // debugger;
        for(const incOrExp in chartData) {
            for(const currency in chartData[incOrExp]) {
                var chart = {

                };

                chart[incOrExp+'-'+currency] = c3.generate({
                    bindto: '#cash-chart-' + incOrExp + '-' + currency,
                    data: chartData[incOrExp][currency]
                });
                charts.push(chart);
            }
        }
    }(jQuery))
</script>

</div>
