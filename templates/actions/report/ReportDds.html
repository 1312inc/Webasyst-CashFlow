{** $currentPeriod cashReportDdsPeriod **}
{** $reportPeriods cashReportDdsPeriod[] **}
{** $ddsTypes cashReportDdsTypeDto[] **}
{** $type cashReportDdsTypeDto **}
{** $grouping cashReportDdsPeriodGroupingDto[] **}
{** $data cashReportDdsStatDto[] **}

<div class="content left200px">

<h1>[`Cash flow report`]</h1>

<div class="block">
    <input type="hidden" value="{$type->id}" name="dds[type]"/>
    <ul class="menu-h with-icons">
        {foreach $ddsTypes as $ddsType}
        <li>
            <a href="#/report/dds/{$ddsType->id}"
               {if $type->id == $ddsType->id}class="selected"{/if}
            >
                {$ddsType->name|escape}
            </a>
        </li>
        {/foreach}
    </ul>
</div>

<ul class="menu-h dropdown float-right">
    <li>
        <a href="#" class="inline-link gray"><b><i>{$currentPeriod->getName()}</i></b><i class="icon10 darr"></i></a>
        <ul class="menu-v">
            {foreach $reportPeriods as $reportPeriod}
            <li>
                <a href="#"
                   data-cash-period-start="{$reportPeriod->getStartDate()}"
                   data-cash-period-end="{$reportPeriod->getEndDate()}"
                >
                    {$reportPeriod->getName()|escape}
                </a>
            </li>
            {/foreach}
        </ul>
    </li>
</ul>

<table class="zebra">
    <thead>
    <tr>
        <th></th>
         {foreach $grouping as $group}
         <th>{$group->name|escape}</th>
         {/foreach}
        <th></th>
        <th></th>
    </tr>
    </thead>

    <tbody>
    {foreach $data as $datum}
    <tr>
        {if !empty($datum->valuesPerPeriods)}
        <td>
            {if $datum->entity->isHeader()}<b>{/if}
            {$datum->entity->getIcon()} {$datum->entity->getName()|escape}
            {if $datum->entity->isHeader()}</b>{/if}
        </td>
        {foreach $datum->valuesPerPeriods as $values}
        <td>
        {foreach $values as $value}
            <div>{$value.per_month} {$datum->currencies[$value.currency]->getSign()}</div>
        {/foreach}
        </td>
        {/foreach}
        {if $datum->entity->isHeader()}
        <td rowspan="{if $datum->entity->isExpense()}{$entityStat.expenses}{/if}{if $datum->entity->isIncome()}{$entityStat.incomes}{/if}">
            {foreach $datum->currencies as $currency}
            График {if $datum->entity->isExpense()}expense{/if}{if $datum->entity->isIncome()}income{/if} {$currency->getCode()}
            <br>
            <div class="c-chart-pie"
                 id="cash-chart-{if $datum->entity->isExpense()}{cashReportDds::ALL_EXPENSE_KEY}{/if}{if $datum->entity->isIncome()}{cashReportDds::ALL_INCOME_KEY}{/if}-{$currency->getCode()}"
            ></div>
            {/foreach}
        </td>
        {/if}
        {/if}
    </tr>
    {/foreach}
    </tbody>
</table>

{*    <pre>{$data|print_r}</pre>*}

<script>
    "use strict";
    (function ($){
        var chartData = {$chartData},
            charts = [];

        // debugger;
        for(const incOrExp in chartData) {
            for(const currency in chartData[incOrExp]) {
                var chart = {

                };

                chart[incOrExp+'-'+currency] = c3.generate({
                    bindto: '#cash-chart-' + incOrExp + '-' + currency,
                    data: chartData[incOrExp][currency]
                });
                charts.push(chart);
            }
        }
    }(jQuery))
</script>

</div>
