<script src="{$wa_app_static_url}js/amcharts/core.js"></script>
<script src="{$wa_app_static_url}js/amcharts/charts.js"></script>
<script src="{$wa_app_static_url}js/amcharts/themes/animated.js"></script>
{if $wa->locale() !== 'en_US'}
<script src="{$wa_app_static_url}js/amcharts/lang/{$wa->locale()}.js"></script>
{/if}
<script type="module">
    import reportStream from "{$wa_app_static_url}js/reports/reportStream.js";
    import renderRangeToggle from '{$wa_app_static_url}js/reports/rangeToggle.js';
    const data = {$data};
    reportStream('chartdiv_stream', {$data}, '{$wa->locale()}');

    $(function () {
        renderRangeToggle('.range-container', [30, 90, 365], updateDates);
        $('.range-container button').on('click', updateDates);

        function updateDates () {
            const from = $('.range-container [name="from"]').val();
            const to = $('.range-container [name="to"]').val();
            window.location = 'from=' + from + '&to=' + to;
        }
    });
</script>

<div class="block">
    <h1>[`Stream`]</h1>

    <div class="flexbox wrap middle space-16">

        <div class="currencies-container toggle custom-mb-12" style="display: none;"></div>
    
        <div class="range-container flexbox space-8 custom-mb-12">
            <div class="dropdown" id="range-dropdown">
                <button class="dropdown-toggle button nowrap" type="button">Выбрать даты</button>
                <div class="dropdown-body">
                    <ul class="menu">
                        <li>
                            <a data-range="30" href="#"><span>Последние 30 дней</span></a>
                        </li>
                        <li>
                            <a data-range="90" href="#"><span>Последние 90 дней</span></a>
                        </li>
                        <li>
                            <a data-range="365" href="#"><span>Последние 365 дней</span></a>
                        </li>
                        <li>
                            <a data-range="custom" href="#"><span>Выбрать даты</span></a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="range-manual flexbox" style="display: none;">
                <input type="text" class="dateFrom" style="width: 120px;" />
                <input type="text" class="dateTo" style="width: 120px;" />
                <button>Показать</button>
                <input type="hidden" name="from" value="{$from}">
                <input type="hidden" name="to" value="{$to}">
            </div>
        </div>

    </div>

    
    {if $data === '[]'}
        [`No data`]
    {/if}

    <div id="chartdiv_stream" style="height: 500px; width: 100%;"></div>

</div>
