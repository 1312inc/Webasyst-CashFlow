<h1>Плагин Тинькофф для бизнеса</h1>

{function name="select_categories" s_name="" settings=[]}
    {$selected = ifset($settings, 'mapping', $s_name, '')}
    <div class="wa-select">
        <select name="cash_tinkoff[mapping][{$s_name}]">
            <option value="" disabled>--[`ДОХОД`]--</option>
            {foreach $categories as $_category}
                {if $_category.type == 'income'}
                <option value="{$_category.id}"{if $selected == $_category.id} selected{/if}>{$_category.name}</option>
                {/if}
            {/foreach}
            <option value="" disabled>--[`РАСХОД`]--</option>
            {foreach $categories as $_category}
                {if $_category.type == 'expense'}
                <option value="{$_category.id}"{if $selected == $_category.id} selected{/if}>{$_category.name}</option>
                {/if}
            {/foreach}
        </select>
    </div>
{/function}

<ul class="tabs">
    <li class="selected">
        <a href="javascript:void(0);">
            Профиль 1
        </a>
    </li>
    <li>
        <i class="fas fa-plus"></i>
    </li>
</ul>

<div class="fields form">
    <form action="?module=plugins&id=tinkoff&action=save" method="post" id="plugins-settings-form">
        {$wa->csrf()}
        <div class="field">
            <div class="name">
                [`Access Token`]
            </div>
            <div class="value">
                <input class="long" type="password" name="cash_tinkoff[access_token]" value="{if isset($settings.access_token)}{$settings.access_token}{/if}" autocomplete="new-password">
                <p class="hint">
                    Получите токен доступа для вашего домена на веб-сайте
                    <a href="https://www.tinkoff.ru/business/" target="_blank">www.tinkoff.ru</a>
                    по <a href="https://developer.tinkoff.ru/docs/intro/manuals/self-service-auth" target="_blank">инструкции</a>
                </p>
            </div>
        </div>

        <div class="field">
            <div class="name">
                [`Счет`]
            </div>
            <div class="value">
                <div class="wa-select">
                    <select name="cash_tinkoff[cash_account]">
                        {foreach $cash_accounts as $_cash_account}
                            <option value="{$_cash_account.id}"{if ifset($settings, 'cash_account', 0) == $_cash_account.id} selected{/if}>{$_cash_account.name}</option>
                        {/foreach}
                    </select>
                </div>
                <p class="hint">
                    Счет в который производится импорт
                </p>
            </div>
        </div>

        <div class="fields-group">
            <h5 class="heading">Маппинг категорий</h5>
            {foreach $operations as $name => $desc}
            <div class="field">
                <div class="name">{$desc}</div>
                <div class="value">
                    {select_categories s_name=$name settings=$settings}
                </div>
            </div>
            {/foreach}
        </div>

        <div class="field">
            <div class="value submit">
                <input type="hidden" name="profile" value="1">
                <input type="submit" class="button green" value="[s`Save`]">
                <span id="plugins-settings-form-status" style="display:none"></span>
            </div>
        </div>
    </form>
</div>


<script>
    (function ($) {
        $('.tabs').waTabs();
    })(jQuery);
</script>


