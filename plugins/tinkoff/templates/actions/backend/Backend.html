<div id="cash-import-page" class="article wide">
    <div class="article-body">
        <h1>[`Tinkoff &rarr; Cash`]</h1>

        {include 'templates/actions/import/ImportTab.html'}

        <p>[`Интеграция с Тинькофф банком доступна только для юридических лиц`]</p>

        <div class="fields">
            <div class="field">
                <div class="name">
                    [`Тинькофф ID`]
                </div>
                <div class="value">
                    {if empty($profile.oauth)}
                        <a href="javascript:void(0);" class="button orange js-tinkoff-connect">[`Подключить`]</a>
                    {else}
                        [`Все подключено!`]
                        <strong>{$profile.oauth|escape|default:''}</strong>
                    {/if}
                    <input type="hidden" name="cash_tinkoff[profiles][{$profile_id}][oauth]" class="js-oauth" value="{if isset($profile.oauth)}{$profile.oauth|escape}{/if}">
                </div>
            </div>

            <div class="field">
                <div class="name">
                    [`Импорт операций`]
                </div>
                <div class="value">
                    <div class="custom-mb-4">
                        <label>
                            <span class="wa-radio">
                                <input type="radio" name="" value="" disabled />
                                <span></span>
                            </span>
                            [`All time`]
                        </label>
                        <span class="hint"></span>
                    </div>
                    <div>
                        <label>
                            <span class="wa-radio">
                                <input type="radio" name="" value="" disabled />
                                <span></span>
                            </span>
                            [`Only orders paid after`]
                        </label>
                        <span class="input-with-inner-icon left">
                            <input type="text" name="" class="shorter small" disabled />
                            <span class="icon"><i class="fas fa-calendar"></i></span>
                        </span>
                    </div>
                </div>
            </div>

            <div class="custom-my-24">
                <hr class="custom-m-0">
            </div>

            <div class="field custom-mb-40">
                <div class="name"></div>
                <div class="value">
                    <a href="{$settings_url}">[`Перейти в настройки импорта`]</a>
                </div>
            </div>

            <div class="field">
                <div class="name"></div>
                <div class="value">
                    <input type="button"
                           id="cash-tinkoff-start"
                           class="button green"
                           value="[`Импортировать операции из банка`]"
                           disabled
                    />
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $('.js-tinkoff-connect').on('click', function () {
        $(this).addClass('disabled');
        $.get('?plugin=tinkoff&module=auth', { 'ref': 'import' }, function (data) {
            console.log('data', data);
            if (data.data.redirect_url) {
                window.location.href = data.data.redirect_url;
            } else if (data.data.error_description) {
                alert(data.data.error_description);
            } else if (data.data.tinkoff_id) {
                //
            }
        });
    });
</script>
